library(tidyverse)
getwd()
data <- read_csv("~/Documents/UW/Year 4/seattle-staying-mapping/Data/05_SPL_Demographics.csv")
data(head)
head(data)
knitr::opts_chunk$set(echo = TRUE)
SPL <- read.csv(here("data","03_SPL_Staying.csv"))
rm(list=ls())
library(tidyverse)
library(psych)
library(dplyr)
library(sf)
library(here)
library(leaflet)
SPL <- read.csv(here("data","03_SPL_Staying.csv"))
data <- read.csv(here("data","05_SPL_Demographics.csv"))
View(SPL)
#Create a separate dataset for 2018 and 2023 data
SPL_1823 <- SPL%>%
filter(study_id=="2018_Seattle_Citywide" | study_id =="2023_Seattle_Citywide")
SPL_1823 <- SPL_1823 %>%
mutate(
gender=recode(staying_gender,
"Female"="Fem",
"Feminine presenting"="Fem",
"Gender-non-conforming presenting" = "non_conforming",
"Male"="Masc",
"Masculine presenting"="Masc",
"Other_Unsure"="Unsure",
"Unsure"="Unsure"))
SPL_1823 <- SPL_1823 %>%
mutate(
neighborhood = gsub("\\d+","",location_id)) #\\d matches any digits, replaced it with an empty string
Ratio <- SPL_1823%>%
group_by(neighborhood, gender, study_id)%>%
dplyr::summarise(count= n())%>%
pivot_wider(
id_cols = c(neighborhood, study_id),
names_from = gender,
values_from = count,
names_prefix = "Observed_"
)%>%
mutate(
FM_ratio = round(Observed_Fem/Observed_Masc, 2)
)%>%
select(neighborhood, study_id, FM_ratio)
Geospatial <- st_read("https://data.seattle.gov/resource/v4q3-5hvp.geojson")
site <- read.csv(here("data","02_SPL_location.csv"))
#Combine Geo-spatial and site specific information
Geospatial <- left_join(Geospatial, site, by="location_id")
#Combine Geospatial and SPL_1823 data----
SPL_plot <- left_join(SPL_1823, Geospatial, by="location_id")%>%
select(unique_staying_id:location_id, #23 study has latitude and longitude
FM_ratio,
location_neighborhood,
neighborhood,
geometry)
Ratio <- SPL_1823%>%
group_by(neighborhood, gender, study_id)%>%
dplyr::summarise(count= n())%>%
pivot_wider(
id_cols = c(neighborhood, study_id),
names_from = gender,
values_from = count,
names_prefix = "Observed_"
)%>%
mutate(
FM_ratio = round(Observed_Fem/Observed_Masc, 2)
)%>%
select(neighborhood, study_id, FM_ratio)
SPL_1823 <- left_join(SPL_1823, Ratio, by=c("neighborhood","study_id"))
Geospatial <- st_read("https://data.seattle.gov/resource/v4q3-5hvp.geojson")
site <- read.csv(here("data","02_SPL_location.csv"))
#Combine Geo-spatial and site specific information
Geospatial <- left_join(Geospatial, site, by="location_id")
#ggplot(Geospatial)+geom_sf()
#Combine Geospatial and SPL_1823 data----
SPL_plot <- left_join(SPL_1823, Geospatial, by="location_id")%>%
select(unique_staying_id:location_id, #23 study has latitude and longitude
FM_ratio,
location_neighborhood,
neighborhood,
geometry)
#Seattle street map
map <- st_read(here("data","04_SPL_Seattle_Map.geojson"))
View(SPL_1823)
View(SPL_plot)
SPL_18 <- SPL_plot%>%
filter(study_id=="2018_Seattle_Citywide")%>%
mutate(
neighborhood_recode = recode(location_neighborhood, #Check and record neiborhood names to match the base map neighborhoods
"23rd & Union - Jackson" = "Pinehurst",
"Capitol Hill"= "Broadway",
"Bitter Lake Village" = "Bitter Lake",
"Magnolia" = "Carleton Park",
"Upper Queen Anne" = "North Queen Anne",
"Pike/Pine" = "Pike-Market",
"Greenwood - Phinney Ridge" = "Greenwood",
"Westwood - Highland Park"= "Highland Park",
"Othello" ="Columbia City",
"Madison Miller" = "Stevens",
"Uptown" = "Lower Queen Anne",
"First Hill / 12th Ave" = "Broadview",
"West Seattle Junction" = "Gatewood",
"Commercial Core" = "Central Business District",
"Mt Baker"= "Mount Baker",
"Chinatown / ID" = "International District",
"Northgate" = "Maple Leaf",
"Lake City" = "Victory Heights"
))%>%
mutate(
longitude=st_coordinates(st_centroid(geometry))[,1], #Extract the longitude
latitude=st_coordinates(st_centroid(geometry))[,2]   #Extract the latitude
)%>%
select(neighborhood_recode,
longitude,
latitude,
FM_ratio)
#Join the city map data with 2018 filtered data ----
merge <- left_join(map, SPL_18, by=c("S_HOOD"="neighborhood_recode"))
merge_no_na <- merge[!is.na(merge$FM_ratio),]
write.csv(SPL_plot, here("data", "datafordemographics.csv"))
table(data$Community.Reporting.Area.Name)
table(SPL_plot$neighborhood)
table(data$Community.Reporting.Area.Name)
table(SPL_plot$neighborhood)
table(data$Community.Reporting.Area.Name)
data <- rename(Community.Reporting.Area.Name,
ALK = "Alki/Admiral")
data$Community.Reporting.Area.Neighborhoods
data <- rename(Community.Reporting.Area.Name,
ALK = "Alki/Admiral")
data <- data %>% rename(Community.Reporting.Area.Name,
ALK = "Alki/Admiral")
data <- data %>% rename(Community.Reporting.Area.Name,
"Alki/Admiral" = ALK)
data <- data %>% rename(Community.Reporting.Area.Name,
"ALK" = "Alki/Admiral")
data <- data %>% mutate(neighborhood =
recode(Community.Reporting.Area.Name,
"ALK" = "Alki/Admiral"))
table(data$Community.Reporting.Area.Name)
#Save csv
write.csv(SPL_1823, here("data", "datafordemographics.csv"))
staying <- read.csv(here("data", "datafordemographics.csv"))
table(staying$neighborhood)
View(merge)
View(merge_no_na)
View(SPL_plot)
staying <- read.csv(here("data", "datafordemographics.csv"))
rm(list=ls())
library(tidyverse)
library(psych)
library(dplyr)
library(sf)
library(here)
library(leaflet)
SPL <- read.csv(here("data","03_SPL_Staying.csv"))
#Create a separate dataset for 2018 and 2023 data
SPL_1823 <- SPL%>%
filter(study_id=="2018_Seattle_Citywide" | study_id =="2023_Seattle_Citywide")
SPL_1823 <- SPL_1823 %>%
mutate(
gender=recode(staying_gender,
"Female"="Fem",
"Feminine presenting"="Fem",
"Gender-non-conforming presenting" = "non_conforming",
"Male"="Masc",
"Masculine presenting"="Masc",
"Other_Unsure"="Unsure",
"Unsure"="Unsure"))
table(SPL_1823$gender)
SPL_1823 <- SPL_1823 %>%
mutate(
neighborhood = gsub("\\d+","",location_id)) #\\d matches any digits, replaced it with an empty string
# check neighborhoods
unique(SPL_1823$neighborhood)
table(SPL_1823$neighborhood)
Ratio <- SPL_1823%>%
group_by(neighborhood, gender, study_id)%>%
dplyr::summarise(count= n())%>%
pivot_wider(
id_cols = c(neighborhood, study_id),
names_from = gender,
values_from = count,
names_prefix = "Observed_"
)%>%
mutate(
FM_ratio = round(Observed_Fem/Observed_Masc, 2)
)%>%
select(neighborhood, study_id, FM_ratio)
SPL_1823 <- left_join(SPL_1823, Ratio, by=c("neighborhood","study_id"))
Geospatial <- st_read("https://data.seattle.gov/resource/v4q3-5hvp.geojson")
site <- read.csv(here("data","02_SPL_location.csv"))
#Combine Geo-spatial and site specific information
Geospatial <- left_join(Geospatial, site, by="location_id")
#ggplot(Geospatial)+geom_sf()
#Combine Geospatial and SPL_1823 data----
SPL_plot <- left_join(SPL_1823, Geospatial, by="location_id")%>%
select(unique_staying_id:location_id, #23 study has latitude and longitude
FM_ratio,
location_neighborhood,
neighborhood,
geometry)
#Seattle street map
map <- st_read(here("data","04_SPL_Seattle_Map.geojson"))
#S_Hood: neighborhood
#L_Hood: district
# Filter 2018 data ----
SPL_18 <- SPL_plot%>%
filter(study_id=="2018_Seattle_Citywide")%>%
mutate(
neighborhood_recode = recode(location_neighborhood, #Check and record neiborhood names to match the base map neighborhoods
"23rd & Union - Jackson" = "Pinehurst",
"Capitol Hill"= "Broadway",
"Bitter Lake Village" = "Bitter Lake",
"Magnolia" = "Carleton Park",
"Upper Queen Anne" = "North Queen Anne",
"Pike/Pine" = "Pike-Market",
"Greenwood - Phinney Ridge" = "Greenwood",
"Westwood - Highland Park"= "Highland Park",
"Othello" ="Columbia City",
"Madison Miller" = "Stevens",
"Uptown" = "Lower Queen Anne",
"First Hill / 12th Ave" = "Broadview",
"West Seattle Junction" = "Gatewood",
"Commercial Core" = "Central Business District",
"Mt Baker"= "Mount Baker",
"Chinatown / ID" = "International District",
"Northgate" = "Maple Leaf",
"Lake City" = "Victory Heights"
))%>%
mutate(
longitude=st_coordinates(st_centroid(geometry))[,1], #Extract the longitude
latitude=st_coordinates(st_centroid(geometry))[,2]   #Extract the latitude
)%>%
select(neighborhood_recode,
longitude,
latitude,
FM_ratio)
#Join the city map data with 2018 filtered data ----
merge <- left_join(map, SPL_18, by=c("S_HOOD"="neighborhood_recode"))
merge_no_na <- merge[!is.na(merge$FM_ratio),]
#Plot----
map_2018 <- ggplot() +
geom_sf(data = merge, aes(fill = FM_ratio)) +
#geom_text(data = merge_no_na, aes(label = S_HOOD, x=longitude, y=latitude), size = 3, color = "black", check_overlap = TRUE)+ #Need to troubleshoot
scale_fill_gradient(name = "Female-to-male staying ratio",
low = "lightblue", high = "pink", na.value = "gray",
guide = guide_colorbar(title.position = "top")) +
labs(title = "2018 Female-to-Male Staying Ratio by Seattle Neighborhood ") +
theme_minimal()+
theme(
plot.title = element_text(family = "Times New Roman", size = 16, face = "bold")
)
SPL_23 <- SPL_plot%>%
filter(study_id=="2023_Seattle_Citywide")%>%
mutate(
neighborhood_recode = recode(location_neighborhood,
"Capitol Hill"= "Broadway",
"Bitter Lake Village" = "Bitter Lake",
"Chinatown / ID" = "International District",
"Commercial Core" = "Central Business District",
"First Hill / 12th Ave" = "Broadview",
"Lake City" = "Victory Heights",
"Mt Baker"= "Mount Baker",
"Northgate" = "Maple Leaf",
"Pike/Pine" = "Pike-Market",
"Westwood - Highland Park"= "Highland Park",
"Othello" ="Columbia City",
"Uptown" = "Lower Queen Anne"
))%>%
select(neighborhood_recode,
FM_ratio)
merge_23 <- left_join(map, SPL_23, by=c("S_HOOD"="neighborhood_recode"))
map_23 <- ggplot() +
geom_sf(data = merge_23, aes(fill = FM_ratio)) +
scale_fill_gradient(name = "Female-to-male staying ratio",
low = "lightblue", high = "pink", na.value = "gray",
guide = guide_colorbar(title.position = "top")) +
labs(title = "2023 Female-to-Male Staying Ratio by Seattle Neighborhood ") +
theme_minimal()+
theme(
plot.title = element_text(family = "Times New Roman", size = 16, face = "bold")
)
map_23
View(SPL_1823)
View(SPL_18)
View(SPL_23)
View(SPL_1823)
library(tidyverse)
#data from: https://data-seattlecitygis.opendata.arcgis.com/datasets/SeattleCityGIS::selected-demographic-and-housing-estimates-dp05/about
demo <- read.csv(here("data","05_SPL_Demographics.csv"))
library(here)
#data from: https://data-seattlecitygis.opendata.arcgis.com/datasets/SeattleCityGIS::selected-demographic-and-housing-estimates-dp05/about
demo <- read.csv(here("data","05_SPL_Demographics.csv"))
table(demo$Community.Reporting.Area.Name)
table(demo$ACS.Vintage)
demo <- filter(ACS.Vintage == 5Y20)
demo <- filter(ACS.Vintage == "5Y20")
demo <- data %>% filter(ACS.Vintage == "5Y20")
demo <- data %>% filter(ACS.Vintage == "5Y20")
demo <- demo %>% filter(ACS.Vintage == "5Y20")
table(demo$Tract.Label)
table(demo$Community.Reporting.Area.ID)
table(demo$Community.Reporting.Area.Group)
table(demo$Community.Reporting.Area.Neighborhoods)
table(demo$Community.Reporting.Area.Name)
